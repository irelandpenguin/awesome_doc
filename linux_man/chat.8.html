<HTML>
<HEAD>
<META http-equiv="content-type" content="text/html; charset=gb2312">
<META name="man2html Chinese version">
<TITLE>CHAT</TITLE>
</HEAD>
<BODY>
<H1>CHAT</H1>
Section: Maintenance Commands (8)<BR>Updated: 22 May 1999<BR>Index</A>

<H2>NAME</H2>

chat - cC自贤ǖ闹噶罡

<H2>总览 SYNOPSIS</H2>

<B>chat</B>

[
<I>options</I>

]
<I>script</I>


<H2>描述 DESCRIPTION</H2>

<P>

<I>chat</I> 程式在XcC之g定x贤交Q事宜。 它最主要的
目的是用碓邳ccf定的[形程式 (pppd) 以及h端的 pppd  程序
之g建立B。

<H2>选项 OPTIONS</H2>

<DL COMPACT>
<DT><B>-f </B><I>&lt;chat file&gt;</I>

<DD>
 chat n案x取 chat 指令稿。@x的使用c chat 的
令稿祷コ(mutually exclusive)。使用者必具有存取
n案的x取唷Ｔn案中允S多(multiple lines)O定。
要以空白或是M向定位(horizontal tab)字元矸指糇执。
<DT><B>-t </B><I>&lt;timeout&gt;</I>

<DD>
於所要接收的期待字串(expected string)O定逾r限制。  如果在rg限制]有接收到字串的那N就不送出回覆  字串(reply string)。 可以送出一通(alternate)的回覆  或者如果]有通的回覆字串t指令稿失　Ｒ失  的指令稿使得 chat 程式以一非零的e`aY束。
<DT><B>-r </B><I>&lt;report file&gt;</I>

<DD>
Set the file for output of the report strings. If you use the keyword
<I>REPORT</I>, the resulting strings are written to this file. If this
option is not used and you still use <I>REPORT</I> keywords, the
<I>stderr</I> file is used for the report strings.
<DT><B>-e</B>

<DD>
Start with the echo option turned on. Echoing may also be turned on
or off at specific points in the chat script by using the <I>ECHO</I>
keyword. When echoing is enabled, all output from the modem is echoed
to <I>stderr</I>.
<DT><B>-E</B>

<DD>
Enables environment variable substituion within chat scripts using the
standard <I>$xxx</I> syntax.
<DT><B>-v</B>

<DD>
要求 chat 指令稿以冗L(verbose)模式绦小 @ chat 程  式接下⑺有C接收的文字以及出的字串到  SYSLOG 去。The default is to log through the SYSLOG;
the logging method may be altered with the -S and -s flags.
<DT><B>-V</B>

<DD>
Request that the <I>chat</I> script be executed in a stderr verbose
mode. The <I>chat</I> program will then log all text received from the
modem and the output strings sent to the modem to the stderr device. This
device is usually the local console at the station running the chat or
pppd program.
<DT><B>-s</B>

<DD>
Use stderr.  All log messages from '-v' and all error messages will be
sent to stderr.
<DT><B>-S</B>

<DD>
Do not use the SYSLOG.  By default, error messages are sent to the
SYSLOG.  The use of -S will prevent both log messages from '-v' and
error messages from being sent to the SYSLOG.
<DT><B>-T </B><I>&lt;phone number&gt;</I>

<DD>
Pass in an arbitary string, usually a phone number, that will be
substituted for the \T substitution metacharacter in a send string.
<DT><B>-U </B><I>&lt;phone number 2&gt;</I>

<DD>
Pass in a second string, usually a phone number, that will be
substituted for the \U substitution metacharacter in a send string.
This is useful when dialing an ISDN terminal adapter that requires two 
numbers.
<DT><B>script</B>

<DD>
script 如果指令稿]有以 -f x指定在n案e那N指令稿如同  蛋惚话含在 chat 程式e。
</DL>

<H2>CHAT 脚本 SCRIPT</H2>

<P>

<I>chat</I> 脚本定x通^程
<P>

一指令稿e包含一或多期待Ψ剿统(expect-send)的配
字串(pairs of string)，以空白隔_，有一x裥缘抹期待Ψ
送出之候a(subexpect-subsend)配ψ执，以短(dash)隔_。像
下面@例子：
<DL COMPACT>
<DT><DD>
ogin:-BREAK-ogin: ppp ssword: hello2u2
</DL>
<P>

@一行指示 chat 程式期待 &quot;ogin:&quot; @字串。如果在所分配的
rg^g冉邮蘸入提示失〉脑， 那它就送出一中喑绦(break
sequence)oh端然後期待 &quot;ogin:&quot; @字串。 如果第一 &quot;ogin:&quot;
被接收到那N中喑绦蚓筒a生。
<P>

一旦它接收到入提示t chat 程式送出 ppp @字串然後期
待 &quot;ssword:&quot; @提示。它接收到密a提示以後，它送出密a
hello2u2 。
<P>

一般在回覆字串後面跟著送出一C架返回(carriage return)。在
期待字串e除非以   字元程序(character sequence)指定楸
否t不期待它的出F。
<P>

期待程序(expect sequence)只包含辨J字串所需要的Y料。因
它一般是Ψ旁诖诺n案e，它不包含拥馁Y。 通常以期待
字串ふrg字串(time strings)， W路辨R字串(network iden-
tification strings)，或是其它拥馁Y料是不被接受的。
<P>

榍f助修正在初始化程序中(initial sequence) 可能魉湾e`的
字元，所以ふ &quot;ogin:&quot; @字串而不是 &quot;login:&quot; 。 _^的  &quot;l&quot;
字元可能接收e`而你永h找不到字串， 即使它已被系y送出。
因此故，指令稿ふ &quot;ogin:&quot; 而不是 &quot;login:&quot; 以及 &quot;ssword&quot; 而
不是 &quot;password:&quot; 。
<P>

一非常蔚闹噶罡蹇雌砜赡芟襁@樱
<DL COMPACT>
<DT><DD>
ogin: ppp ssword: hello2u2
</DL>
<P>

Q句f， 期待 ...ogin:,  送出 ppp,  期待 ...ssword:, 再送出
hello2u2 。
<P>

在H使用上，蔚闹噶罡迨呛币的。最少最少， 原先的字串]有
被接收r你要把候a期待(sub-sequences)包括M怼＠如，考]
下面@例子：
<DL COMPACT>
<DT><DD>
ogin:--ogin: ppp ssword: hello2u2
</DL>
<P>

@是一比前面所用的沃噶罡甯好的指令稿。 @ふ蚁嗤
同的 login: 提示，然而, 如果]有接收到的， 送出一为的
返回程序(return sequence)K且它接著再次ふ login: 。要是s
s掩w掉第一 login 提示那N接著送出空路(empty line)常
再次a生入提示。

<H2>COMMENTS</H2>

Comments can be embedded in the chat script. A comment is a line which
starts with the <B>#</B> (hash) character in column 1. Such comment
lines are just ignored by the chat program. If a '#' character is to
be expected as the first character of the expect sequence, you should
quote the expect string.
If you want to wait for a prompt that starts with a # (hash)
character, you would have to write something like this:
<DL COMPACT>
<DT><DD>
# Now wait for the prompt and send logout string
<BR>

'# ' logout
</DL>
<P>

<P>

<H2>SENDING DATA FROM A FILE</H2>

If the string to send starts with an at sign (@), the rest of the
string is taken to be the name of a file to read to get the string to
send.  If the last character of the data read is a newline, it is
removed.  The file can be a named pipe (or fifo) instead of a regular
file.  This provides a way for <B>chat</B> to communicate with another
program, for example, a program to prompt the user and receive a
password typed in.
<P>

<P>

<H2>放弃字符串 ABORT STRINGS</H2>

S多C以字串砘蠛艚械r。 @些字串可能是 CONNECTED
或是 NO CARRIER 或是 BUSY 。 通常要是CB到h端失〉脑
希望Y束指令稿。 困y是指令稿不_地知道它可能接收到
哪C字串。在某次Lr， 他可能接收到 BUSY 然而下次它可
能接收到 NO CARRIER 。
<P>

@些失〃字串可以用 ABORT 程序指定到指令稿中。像是下面@
例子般地到指令稿e：
<DL COMPACT>
<DT><DD>
ABORT BUSY ABORT 'NO CARRIER' '' ATZ OK ATDT5551212 CONNECT
</DL>
<P>

@程序⒉期待什N；而且接著送出 ATZ @字串。Υ似诖的
回是 OK @字串。它接收到 OK r，字串 ADTD5551212 就M行
芴。期待字串是 CONNECT 。 如果字串 CONNECT 被接收到那N就
绦兄噶罡迤漯N的部份。然而，要是ClF忙， 他送
出 BUSY @字串。 @使得字串符合失∽衷程序(abort char-
acter)。 @指令稿因樗lF一失∽执(abort string)而
失(fail)。如果他接收到的是 NO CARRIER 字串， 它也因橥
的原因而失　２皇强梢越邮盏阶执就是字串⒔KY chat 指令稿。

<H2>CLR_ABORT STRINGS</H2>

This sequence allows for clearing previously set <B>ABORT</B> strings.
<B>ABORT</B> strings are kept in an array of a pre-determined size (at
compilation time); <B>CLR_ABORT</B> will reclaim the space for cleared
entries so that new strings can use that space.

<H2>SAY STRINGS</H2>

The <B>SAY</B> directive allows the script to send strings to the user
at the terminal via standard error.  If <B>chat</B> is being run by
pppd, and pppd is running as a daemon (detached from its controlling
terminal), standard error will normally be redirected to the file
/etc/ppp/connect-errors.
<P>

<B>SAY</B> strings must be enclosed in single or double quotes. If
carriage return and line feed are needed in the string to be output,
you must explicitely add them to your string.
<P>

The SAY strings could be used to give progress messages in sections of
the script where you want to have 'ECHO OFF' but still let the user
know what is happening.  An example is:
<DL COMPACT>
<DT><DD>
ABORT BUSY 
<BR>

ECHO OFF 
<BR>

SAY &quot;Dialling your ISP...\n&quot; 
<BR>

'' ATDT5551212 
<BR>

TIMEOUT 120
<BR>

SAY &quot;Waiting up to 2 minutes for connection ... &quot;
<BR>

CONNECT '' 
<BR>

SAY &quot;Connected, now logging in ...
<BR>

ogin: account
<BR>

ssword: pass
<BR>

$ SAY &quot;Logged in OK ...
<I>etc ...</I>
</DL>
<P>

This sequence will only present the SAY strings to the user and all
the details of the script will remain hidden. For example, if the
above script works, the user will see:
<DL COMPACT>
<DT><DD>
Dialling your ISP...
<BR>

Waiting up to 2 minutes for connection ... Connected, now logging in ...
<BR>

Logged in OK ...
</DL>
<P>

<P>

<H2>REPORT STRINGS</H2>

A <B>report</B> string is similar to the ABORT string. The difference
is that the strings, and all characters to the next control character
such as a carriage return, are written to the report file.
<P>

The report strings may be used to isolate the transmission rate of the
modem's connect string and return the value to the chat user. The
analysis of the report string logic occurs in conjunction with the
other string processing such as looking for the expect string. The use
of the same string for a report and abort sequence is probably not
very useful, however, it is possible.
<P>

The report strings to no change the completion code of the program.
<P>

These &quot;report&quot; strings may be specified in the script using the <I>REPORT</I>
sequence. It is written in the script as in the following example:
<DL COMPACT>
<DT><DD>
REPORT CONNECT ABORT BUSY '' ATDT5551212 CONNECT '' ogin: account
</DL>
<P>

This sequence will expect nothing; and then send the string
ATDT5551212 to dial the telephone. The expected string is
<I>CONNECT</I>. If the string <I>CONNECT</I> is received the remainder
of the script is executed. In addition the program will write to the
expect-file the string &quot;CONNECT&quot; plus any characters which follow it
such as the connection rate.

<H2>CLR_REPORT STRINGS</H2>

This sequence allows for clearing previously set <B>REPORT</B> strings.
<B>REPORT</B> strings are kept in an array of a pre-determined size (at
compilation time); <B>CLR_REPORT</B> will reclaim the space for cleared
entries so that new strings can use that space.

<H2>ECHO</H2>

The echo options controls whether the output from the modem is echoed
to <I>stderr</I>. This option may be set with the <I>-e</I> option, but
it can also be controlled by the <I>ECHO</I> keyword. The &quot;expect-send&quot;
pair <I>ECHO</I> <I>ON</I> enables echoing, and <I>ECHO</I> <I>OFF</I>
disables it. With this keyword you can select which parts of the
conversation should be visible. For instance, with the following
script:
<DL COMPACT>
<DT><DD>
ABORT   'BUSY'
<BR>

ABORT   'NO CARRIER'
<BR>


<BR>

OK\r\n  ATD1234567
<BR>

\r\n    \c
<BR>

ECHO    ON
<BR>

CONNECT \c
<BR>

ogin:   account
</DL>
<P>

all output resulting from modem configuration and dialing is not visible,
but starting with the <I>CONNECT</I> (or <I>BUSY</I>) message, everything
will be echoed.

<H2>HANGUP</H2>

The HANGUP options control whether a modem hangup should be considered
as an error or not.  This option is useful in scripts for dialling
systems which will hang up and call your system back.  The HANGUP
options can be <B>ON</B> or <B>OFF</B>.
<BR>

When HANGUP is set OFF and the modem hangs up (e.g., after the first
stage of logging in to a callback system), <B>chat</B> will continue
running the script (e.g., waiting for the incoming call and second
stage login prompt). As soon as the incoming call is connected, you
should use the <B>HANGUP ON</B> directive to reinstall normal hang up
signal behavior.  Here is an (simple) example script:
<DL COMPACT>
<DT><DD>
ABORT   'BUSY'
<BR>


<BR>

OK\r\n  ATD1234567
<BR>

\r\n    \c
<BR>

CONNECT \c
<BR>

'Callback login:' call_back_ID
<BR>

HANGUP OFF
<BR>

ABORT &quot;Bad Login&quot;
<BR>

'Callback Password:' Call_back_password
<BR>

TIMEOUT 120
<BR>

CONNECT \c
<BR>

HANGUP ON
<BR>

ABORT &quot;NO CARRIER&quot;
<BR>

ogin:--BREAK--ogin: real_account
<BR>

<I>etc ...</I>
</DL>
<P>


<H2>超时 TIMEOUT</H2>

初始的逾r值是 45 秒。@可以用 -t 砑右愿淖。
<P>

要ο乱期待字串改逾r值的，可以使用下面@例子：
<DL COMPACT>
<DT><DD>
ATZ OK ATDT5551212 CONNECT TIMEOUT 10 ogin:--ogin: TIMEOUT 5 assword: hello2u2
</DL>
<P>

@在期待 &quot;login:&quot; 提示的r候把逾r限制改成 10 秒。 逾r限
制接著在它ふ颐艽a提示r被改成 5 秒。
<P>

逾r限制一旦改就持m作用直到它再度被改。

<H2>SENDING 发送 EOT</H2>

EOT @特e的回覆字串指示 chat 程式送出一 EOT 字元到h
端去。@是一般的n案Y束(End-of-file)字元程序。 在 EOT 後面K
不跟著送出一返回字元(return)。

@ EOT 程序可以用 ^D 序列嵌入到送出的字串e。

<H2>a生中 GENERATING BREAK</H2>

BREAK @特e的回覆字串使得一中嗲r被送出。 @中
是魉投说囊特殊。接收端一般Υ说奶理是改鬏率。 它可以
用硌hyh端可能的鬏率直到你能蚪拥接行У暮入提示。

<BR>&nbsp;@
中喑绦蚩梢杂 <I>\K</I>  序列嵌入到送出的字串e。

<H2>转义序列 ESCAPE SEQUENCES</H2>

期待以及回覆字串可以包含转义序列。 所有@N程序在回覆字串中都
是合法的。有S多在期待字串中是合法的。 那些在期待程序中o效的
被指出。
<DL COMPACT>
<DT><B>''</B>

<DD>
期待或送出一空字串(null string) 。如果你送出一空字  串那N它送出一返回字元。@程序可以是一κ÷苑  (apostrophe)或者也可以是引用字元。
<DT><B>\\b</B>

<DD>
代表一退位(backspace)字元。
<DT><B>\\c</B>

<DD>
抑制在回覆字串Y尾的新列(newline)字元。 @是送出]有返  回字元尾S的字串的唯一方法。它必在送出字串的Y尾。例  如，@程序 hello 蔚厮统鲎衷 h, e, l, l, o。  （在期待字串中o效。）<DT><B>\\d</B>

<DD>
延t一秒。程式使用最L延t橐幻氲 sleep</A>(1) 。（在  期待字串中o效。）
<DT><B>\\K</B>

<DD>
插入一中啵ㄔ谄诖字串中o效。）
<DT><B>\\n</B>

<DD>
送出一新列(newline)或Q行(linefeed)字元。
<DT><B>\\N</B>

<DD>
送出一空字元(null character)。同拥某绦蚩梢杂 &nbsp; 代  替。（在期待字串中o效。）
<DT><B>\\p</B>

<DD>
和Ｒ恍《rg。延t 1/10 秒。（在期待字串中o效。）
<DT><B>\\q</B>

<DD>
抑制字串往 SYSLOG n案。 ?????? 字串被到自己的  空g。（在期待字串中o效。）
<DT><B>\\r</B>

<DD>
魉突蚱诖一C架返回（字元）
<DT><B>\\s</B>

<DD>
代替字串中的空白。@可以用在不引用包含空白的字串之  r。'HI TIM' 以及 HITIM 是相同的。
<DT><B>\\t</B>

<DD>
魉突蚱诖一定位(tab)字元。
<DT><B>\\T</B>

<DD>
Send the phone number string as specified with the <I>-T</I> option
<I>(not valid in expect.)</I>

<DT><B>\\U</B>

<DD>
Send the phone number 2 string as specified with the <I>-U</I> option
<I>(not valid in expect.)</I>

<DT><B>\\\\</B>

<DD>
魉突蚱诖一倒斜(backslash)字元。
<DT><B>\\ddd</B>

<DD>
八M位底 (ddd) 折B(collapse)成我坏 ASCII 字元K  ⑵渌统觥＃某些字元在期待字串中o效。）
<DT><B>^C</B>

<DD>
替Q含有以 C 代表之控制字元的程序。例如，字元 DC1(17)  是以 ^Q 表示。（某些字元在期待字串中o效。）
</DL>

<H2>ENVIRONMENT VARIABLES</H2>

Environment variables are available within chat scripts, if  the <I>-E</I>
option was specified in the command line. The metacharacter <I>$</I> is used
to introduce the name of the environment variable to substitute. If the
substition fails, because the requested environment variable is not set,
<I>nothing</I> is replaced for the variable.

<H2>TERMINATION CODES</H2>

The <I>chat</I> program will terminate with the following completion
codes.
<DL COMPACT>
<DT><B>0</B>

<DD>
The normal termination of the program. This indicates that the script
was executed without error to the normal conclusion.
<DT><B>1</B>

<DD>
One or more of the parameters are invalid or an expect string was too
large for the internal buffers. This indicates that the program as not
properly executed.
<DT><B>2</B>

<DD>
An error occurred during the execution of the program. This may be due
to a read or write operation failing for some reason or chat receiving
a signal such as SIGINT.
<DT><B>3</B>

<DD>
A timeout event occurred when there was an <I>expect</I> string without
having a &quot;-subsend&quot; string. This may mean that you did not program the
script correctly for the condition or that some unexpected event has
occurred and the expected string could not be found.
<DT><B>4</B>

<DD>
The first string marked as an <I>ABORT</I> condition occurred.
<DT><B>5</B>

<DD>
The second string marked as an <I>ABORT</I> condition occurred.
<DT><B>6</B>

<DD>
The third string marked as an <I>ABORT</I> condition occurred.
<DT><B>7</B>

<DD>
The fourth string marked as an <I>ABORT</I> condition occurred.
<DT><B>...</B>

<DD>
The other termination codes are also strings marked as an <I>ABORT</I>
condition.
</DL>
<P>

Using the termination code, it is possible to determine which event
terminated the script. It is possible to decide if the string &quot;BUSY&quot;
was received from the modem as opposed to &quot;NO DIAL TONE&quot;. While the
first event may be retried, the second will probably have little
chance of succeeding during a retry.

</BODY>
</HTML>
